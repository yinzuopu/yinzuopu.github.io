<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yinzuopu.github.io</id>
    <title>Hello Yin</title>
    <updated>2022-08-02T07:31:21.451Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yinzuopu.github.io"/>
    <link rel="self" href="https://yinzuopu.github.io/atom.xml"/>
    <subtitle>ä½ å¥½ï¼Œæˆ‘çˆ±è¿™ä¸ªä¸–ç•Œ~</subtitle>
    <logo>https://yinzuopu.github.io/images/avatar.png</logo>
    <icon>https://yinzuopu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, Hello Yin</rights>
    <entry>
        <title type="html"><![CDATA[Flaskæ¡†æ¶ï¼šä½¿ç”¨Flaskæ­å»ºä¸€ä¸ªç®€å•çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æœåŠ¡]]></title>
        <id>https://yinzuopu.github.io/post/flask-kuang-jia-shi-yong-flask-da-jian-yi-ge-jian-dan-de-jie-kou-zi-dong-hua-ce-shi-fu-wu/</id>
        <link href="https://yinzuopu.github.io/post/flask-kuang-jia-shi-yong-flask-da-jian-yi-ge-jian-dan-de-jie-kou-zi-dong-hua-ce-shi-fu-wu/">
        </link>
        <updated>2022-08-02T07:29:01.000Z</updated>
        <summary type="html"><![CDATA[<h3 id="ç›®æ ‡è¯´æ˜">ç›®æ ‡è¯´æ˜</h3>
<p>ä½¿ç”¨flaskæ­å»ºä¸€ä¸ªç®€å•çš„å¯ç”¨äºæ¥å£è‡ªåŠ¨åŒ–çš„apiæœåŠ¡ï¼Œç›¸å…³è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>start.py ç¨‹åºä¸»æ–‡ä»¶ï¼Œç”¨äºå¯åŠ¨ç¨‹åº</li>
<li>api_server.py å®šä¹‰5ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ã€æŸ¥è¯¢å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€å¢åŠ ç”¨æˆ·ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€åˆ é™¤ç”¨æˆ·</li>
<li>test_api.py æµ‹è¯•api_server.pyä¸­è‡ªå®šä¹‰çš„æ¥å£</li>
<li>user.json ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé‡‡ç”¨jsonæ–‡ä»¶å­˜å‚¨</li>
<li>Pythonç‰ˆæœ¬ï¼š3.7.4 (v3.7.4:e09359112e, Jul  8 2019, 14:54:52)</li>
<li>Flaskç‰ˆæœ¬ï¼šFlask 2.1.3</li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<h3 id="ç›®æ ‡è¯´æ˜">ç›®æ ‡è¯´æ˜</h3>
<p>ä½¿ç”¨flaskæ­å»ºä¸€ä¸ªç®€å•çš„å¯ç”¨äºæ¥å£è‡ªåŠ¨åŒ–çš„apiæœåŠ¡ï¼Œç›¸å…³è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>start.py ç¨‹åºä¸»æ–‡ä»¶ï¼Œç”¨äºå¯åŠ¨ç¨‹åº</li>
<li>api_server.py å®šä¹‰5ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ã€æŸ¥è¯¢å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€å¢åŠ ç”¨æˆ·ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€åˆ é™¤ç”¨æˆ·</li>
<li>test_api.py æµ‹è¯•api_server.pyä¸­è‡ªå®šä¹‰çš„æ¥å£</li>
<li>user.json ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé‡‡ç”¨jsonæ–‡ä»¶å­˜å‚¨</li>
<li>Pythonç‰ˆæœ¬ï¼š3.7.4 (v3.7.4:e09359112e, Jul  8 2019, 14:54:52)</li>
<li>Flaskç‰ˆæœ¬ï¼šFlask 2.1.3</li>
</ul>
<!-- more -->
<h2 id="1-flaskä»‹ç»">1ã€Flaskä»‹ç»</h2>
<p>Flask çš„è®¾è®¡æ˜“äºä½¿ç”¨å’Œæ‰©å±•ã€‚å®ƒçš„åˆè¡·æ˜¯ä¸ºå„ç§å¤æ‚çš„Webåº”ç”¨ç¨‹åºæ„å»ºåšå®çš„åŸºç¡€ã€‚å¯ä»¥è‡ªç”±åœ°æ’å…¥ä»»ä½•æ‰©å±•ã€‚ä¹Ÿå¯ä»¥è‡ªç”±æ„å»ºè‡ªå·±çš„æ¨¡å—ã€‚Flask é€‚åˆå„ç§é¡¹ç›®ã€‚å®ƒå¯¹åŸå‹è®¾è®¡ç‰¹åˆ«æœ‰ç”¨ã€‚Flask ä¾èµ–äºä¸¤ä¸ªå¤–éƒ¨åº“ï¼šJinja2 æ¨¡æ¿å¼•æ“å’Œ Werkzeug WSGI å·¥å…·åŒ…ã€‚ Flask æ˜¯æœ€ç²¾è‡´ï¼ŒåŠŸèƒ½æœ€ä¸°å¯Œçš„å¾®æ¡†æ¶ä¹‹ä¸€ã€‚Flask è¿˜å¾ˆå¹´è½»ï¼Œæ‹¥æœ‰è“¬å‹ƒå‘å±•çš„ç¤¾åŒºï¼Œä¸€æµçš„æ‰©å±•å’Œæ¼‚äº®çš„ APIã€‚Flask å…·æœ‰å¿«é€Ÿæ¨¡æ¿ï¼Œå¼ºå¤§çš„ WSGI åŠŸèƒ½ï¼Œåœ¨ Web åº”ç”¨ç¨‹åºå’Œåº“çº§åˆ«çš„å®Œæ•´å•å…ƒå¯æµ‹æ€§ï¼Œä»¥åŠå¤§é‡æ–‡æ¡£ç­‰ä¼˜ç‚¹ã€‚ é€‰ç”¨ Flask æ¡†æ¶ä¹Ÿæ˜¯å› ä¸ºå®ƒæ–¹ä¾¿å…¥æ‰‹ï¼Œç»“æ„ç®€å•ï¼Œé›¶é…ç½®ï¼Œæ˜¯ä¸ªå­¦ä¹  Python Web å¼€å‘çš„å¥½å·¥å…·ã€‚</p>
<h2 id="2-mockæ¥å£ä»‹ç»">2ã€mockæ¥å£ä»‹ç»</h2>
<p>mock / muk æ¥å£ï¼Œå°±æ˜¯æ¨¡æ‹Ÿæ¥å£</p>
<ul>
<li>æš‚æ—¶ä»£æ›¿ç¬¬ä¸‰æ–¹æ¥å£æµ‹è¯•ï¼Œè‡ªå·±æ¨¡æ‹Ÿä¸€ä¸ªæ¥å£</li>
<li>è¾…åŠ©æµ‹è¯•ï¼Œç”¨æ¥ä»£æ›¿æ²¡æœ‰å¼€å‘å¥½çš„æ¥å£</li>
<li>æŸ¥çœ‹æ•°æ®</li>
</ul>
<h2 id="3-å®‰è£…flask">3ã€å®‰è£…Flask</h2>
<pre><code class="language-commandline">pip install flask
</code></pre>
<h2 id="4-æ ‡å‡†ç›®å½•ç»“æ„åˆ†è§£å„ä¸ªç›®å½•æ–‡ä»¶">4ã€ æ ‡å‡†ç›®å½•ç»“æ„ï¼Œåˆ†è§£å„ä¸ªç›®å½•æ–‡ä»¶</h2>
<pre><code class="language-commandline">01flask
â”œâ”€â”€ bin
â”‚Â Â  â””â”€â”€ mian.py         # ç¨‹åºå…¥å£æ–‡ä»¶ï¼Œå°†å¯åŠ¨æœåŠ¡çš„å‘½ä»¤æ”¾åœ¨è¿™é‡Œ
â”œâ”€â”€ conf
â”‚Â Â  â””â”€â”€ user.json       # ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé‡‡ç”¨jsonæ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ lib
â”‚Â Â  â””â”€â”€ api_server.py   # å®šä¹‰5ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ã€æŸ¥è¯¢å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€å¢åŠ ç”¨æˆ·ã€ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€åˆ é™¤ç”¨æˆ·
â””â”€â”€ testcase
    â””â”€â”€ test_api.py     # æµ‹è¯•api_server.pyä¸­è‡ªå®šä¹‰çš„æ¥å£
</code></pre>
<h2 id="5-æ¥å£åˆ†æ">5ã€ æ¥å£åˆ†æ</h2>
<h3 id="51-è®¡åˆ’">5.1 è®¡åˆ’</h3>
<ul>
<li>é¦–å…ˆï¼Œå®‰è£…Flaskç¯å¢ƒï¼ŒåŒæ—¶è¦ç¡®ä¿pythonç‰ˆæœ¬å¤§äº3.6ï¼ˆå› ä¸ºé‡Œé¢ä½¿ç”¨äº†Python f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯­æ³•ï¼‰</li>
<li>æ¥ç€ï¼Œè¿è¡Œapi_server.pyæ–‡ä»¶ï¼Œæ­¤æ—¶ä¼šåœ¨æœ¬åœ°ç›‘å¬8888ç«¯å£ã€‚</li>
<li>ç„¶åï¼Œåœ¨test_api.pyä¸­è¿è¡Œå¯¹åº”çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹å³å¯æµ‹è¯•å¯¹åº”çš„æ¥å£ã€‚</li>
</ul>
<h3 id="52-æ¥å£å†…å®¹">5.2 æ¥å£å†…å®¹</h3>
<pre><code class="language-commandline">GET     http://[hostname]/users                 è·å–ç”¨æˆ·åˆ—è¡¨
GET     http://[hostname]/user/[user_id]        è·å–user_idçš„ç”¨æˆ·ä¿¡æ¯
POST    http://[hostname]/users                 åˆ›å»ºæ–°ç”¨æˆ·
PUT     http://[hostname]/users/[user_id]       æ›´æ–°ç”¨æˆ·ä¿¡æ¯
DELETE  http://[hostname]/users/[user_id]       åˆ é™¤user_idçš„ç”¨æˆ·ä¿¡æ¯    
</code></pre>
<h3 id="53-ç”¨æˆ·ä¿¡æ¯ç»“æ„">5.3 ç”¨æˆ·ä¿¡æ¯ç»“æ„</h3>
<p>ç”¨æˆ·ä¸»è¦åŒ…å«nameã€ageã€likeè¿™3éƒ¨åˆ†ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜å­˜åœ¨1ä¸ªå”¯ä¸€çš„idæ ‡è¯†ï¼Œç”¨äºåŒºåˆ†ç”¨æˆ·ã€‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
    &quot;id&quot;: 1001,
    &quot;name&quot;: &quot;Jim&quot;,
    &quot;age&quot;: &quot;20&quot;,
    &quot;like&quot;: &quot;jogging&quot;
}
</code></pre>
<h2 id="6-ç›¸å…³ä»£ç ">6ã€ç›¸å…³ä»£ç </h2>
<h3 id="61-api_serverpy">6.1 api_server.py</h3>
<pre><code class="language-python">from flask import jsonify, Flask, request
import json

&quot;&quot;&quot;
åŠŸèƒ½ï¼šå®ç°ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æŸ¥è¯¢ã€å¢åŠ ã€ä¿®æ”¹å’Œåˆ é™¤çš„apiæ¥å£ï¼Œå¯ç”¨äºæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•çš„apiæœåŠ¡ã€‚
å“åº”ç»“æœè¯´æ˜ï¼š
1. apiè¯·æ±‚æˆåŠŸï¼Œåˆ™è¿”å›çŠ¶æ€ç 200ï¼ŒåŒæ—¶åœ¨å“åº”ç»“æœä¸­è¿”å›apiè¯·æ±‚çš„ç›¸å…³ä¿¡æ¯,æ¯”å¦‚ï¼š
    {
        &quot;result&quot;: &quot;success&quot;,
        &quot;users&quot;: {xxx}
    }
2. apiè¯·æ±‚å¤±è´¥ï¼Œåˆ™è¿”å›çŠ¶æ€ç 400ï¼ŒåŒæ—¶åœ¨å“åº”ç»“æœä¸­è¿”å›å¤±è´¥çš„åŸå› ï¼Œæ¯”å¦‚ï¼š
    {
        &quot;result&quot;: &quot;There is no user with user_id:xxx&quot;
    }

ä¾èµ–ç¯å¢ƒï¼š
Python 3.9.12
Flask   2.1.2
&quot;&quot;&quot;

app = Flask(__name__)
json_path = &quot;../conf/users.json&quot;  # ä¿å­˜ç”¨æˆ·jsonä¿¡æ¯çš„è·¯å¾„


def get_json(json_path):
    &quot;&quot;&quot;è¯»å–jsonæ•°æ®&quot;&quot;&quot;
    with open(json_path, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
        res = json.load(f)
    return res


def write_json(json_path, json_data):
    &quot;&quot;&quot;å‘æ–‡ä»¶å†™å…¥jsonæ•°æ®&quot;&quot;&quot;
    with open(json_path, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
        json.dump(json_data, f)


@app.route(&quot;/users&quot;, methods=[&quot;GET&quot;])
def get_users():
    &quot;&quot;&quot;è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯&quot;&quot;&quot;
    users = get_json(json_path)[&quot;users&quot;]
    res = {
        &quot;result&quot;: &quot;success&quot;,
        &quot;users&quot;: users
    }
    return jsonify(res), 200


@app.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;GET&quot;])
def get_user(user_id):  # éœ€è¦å°†routeä¸­çš„å‚æ•°ä¼ é€’è¿›æ¥
    &quot;&quot;&quot;æŸ¥è¯¢æŒ‡å®šuser_idçš„ç”¨æˆ·ä¿¡æ¯&quot;&quot;&quot;
    users = get_json(json_path)[&quot;users&quot;]
    user = list(filter(lambda t: t[&quot;id&quot;] == user_id, users))  # è·å–usersä¸­idä¸ºuser_idçš„ç”¨æˆ·åˆ—è¡¨ã€‚
    if len(user) == 0:
        return jsonify({&quot;result&quot;: f&quot;There is no user with user_id:{user_id}&quot;}), 400
    else:
        return jsonify({&quot;result&quot;: &quot;success&quot;, &quot;user&quot;: user[0]}), 200


@app.route(&quot;/users&quot;, methods=[&quot;POST&quot;])
def create_user():
    &quot;&quot;&quot;è¦æ±‚è¯·æ±‚çš„jsonæ•°æ®ä¸­nameã€ageæ˜¯å¿…å¡«é¡¹ï¼Œlikeé€‰å¡«&quot;&quot;&quot;
    required = [&quot;name&quot;, &quot;age&quot;]  # è®¾ç½®å¿…å¡«å‚æ•°
    users = get_json(json_path)[&quot;users&quot;]
    req_json = request.json
    if not req_json:
        return jsonify({&quot;result&quot;: &quot;Please use application/json to submit json data&quot;}), 400

    # è·å–ç¼ºå°‘çš„å¿…å¡«å‚æ•°
    params_list = set(required) - set(req_json.keys())
    if len(params_list) &gt; 0:
        return jsonify({&quot;result&quot;: f&quot;Missing required parameter:{params_list}&quot;}), 400

    # ä¸ºæ–°ç”¨æˆ·è®¾ç½®ä¸€ä¸ªidï¼š
    # 1. å¦‚æœæ²¡æœ‰ä¼ é€’idå‚æ•°ï¼Œä¸”å½“å‰usersä¸­ä¸å­˜åœ¨ç”¨æˆ·ä¿¡æ¯ï¼Œæ­¤æ—¶å°±è®¾ç½®idä¸º1001ã€‚
    # 2. å¦‚æœæ²¡æœ‰ä¼ é€’idå‚æ•°ï¼Œä¸”usersä¸­å­˜åœ¨ç”¨æˆ·ä¿¡æ¯ï¼Œæ­¤æ—¶å°±è·å–æœ€å¤§çš„ç”¨æˆ·idï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Š+1ï¼Œä½œä¸ºnew_idã€‚
    # 3. å¦‚æœä¼ é€’äº†idå‚æ•°ï¼Œä¸”è¿™ä¸ªidå·²ç»å­˜åœ¨ä¸å·²æœ‰çš„idï¼Œæ­¤æ—¶è¿”å›é”™è¯¯ä¿¡æ¯ã€‚
    # 4. å¦‚æœä¼ é€’äº†idå‚æ•°ï¼Œä½†æ˜¯è¿™ä¸ªidä¸å­˜åœ¨ï¼Œæ­¤æ—¶å°±èµ‹å€¼ä¸ºç”¨æˆ·ä¼ é€’çš„idã€‚
    ids = [user[&quot;id&quot;] for user in users]
    if &quot;id&quot; not in req_json.keys():
        if len(ids) == 0:
            new_id = 1001
        else:
            new_id = max(ids) + 1
    else:
        if int(req_json[&quot;id&quot;]) in ids:  # å¦‚æœè‡ªå®šä¹‰çš„idå·²ç»å­˜åœ¨ï¼Œåˆ™æ­¤æ—¶éœ€è¦è¿”å›æç¤ºä¿¡æ¯
            res = {&quot;result&quot;: f'user_id: {req_json[&quot;id&quot;]} already exists'}
            return jsonify(res), 400
        else:
            new_id = int(req_json[&quot;id&quot;])

    # æ–°çš„ç”¨æˆ·æ•°æ®
    user = {
        &quot;id&quot;: new_id,
        &quot;name&quot;: req_json[&quot;name&quot;],
        &quot;age&quot;: req_json[&quot;age&quot;],
        &quot;like&quot;: req_json[&quot;like&quot;] if &quot;like&quot; in req_json.keys() else &quot;&quot;
    }
    users.append(user)
    print(users)
    write_json(json_path, {&quot;users&quot;: users})
    return jsonify({&quot;user&quot;: user, &quot;result&quot;: &quot;success&quot;}), 200


@app.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;PUT&quot;])
def update_user(user_id):
    users = get_json(json_path)[&quot;users&quot;]
    user = list(filter(lambda t: t[&quot;id&quot;] == user_id, users))
    if len(user) == 0:  # è¡¨ç¤ºä¸å­˜åœ¨idä¸ºuser_idçš„ç”¨æˆ·
        return jsonify({&quot;result&quot;: f&quot;There is no user with user_id:{user_id}&quot;}), 400
    if not request.json:  # å½“æ²¡æœ‰æäº¤æ•°æ®æˆ–è€…æ•°æ®æ²¡æœ‰æäº¤åˆ°json
        return jsonify({&quot;result&quot;: &quot;Please use application/json to submit json data&quot;}), 400

    # è¿™é‡Œä¿®æ”¹user[0]ï¼Œå®é™…ä¸Šä¼šä¿®æ”¹usersé‡Œé¢çš„å†…å®¹ï¼Œuseråº”è¯¥ä¹Ÿæ˜¯usersä¸­æŒ‡å®šidçš„å¼•ç”¨
    user[0][&quot;name&quot;] = request.json.get(&quot;name&quot;, user[0][&quot;name&quot;])
    user[0][&quot;age&quot;] = request.json.get(&quot;age&quot;, user[0][&quot;age&quot;])
    user[0][&quot;like&quot;] = request.json.get(&quot;like&quot;, user[0][&quot;like&quot;])

    write_json(json_path, {&quot;users&quot;: users})
    return jsonify(user), 200


@app.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;DELETE&quot;])
def delete_user(user_id):
    users = get_json(json_path)[&quot;users&quot;]
    user = list(filter(lambda t: t[&quot;id&quot;] == user_id, users))
    if len(user) == 0:  # è¡¨ç¤ºä¸å­˜åœ¨idä¸ºuser_idçš„ç”¨æˆ·
        return jsonify({&quot;result&quot;: f&quot;There is no user with user_id:{user_id}&quot;}), 400

    # ç›´æ¥é€šè¿‡removeåˆ é™¤å³å¯ã€‚
    users.remove(user[0])
    write_json(json_path, {&quot;users&quot;: users})
    return jsonify(user), 200
</code></pre>
<h3 id="62-test_apipy">6.2 test_api.py</h3>
<pre><code class="language-python">
import requests
import unittest
import json

class APITest(unittest.TestCase):
    # è¯·æ±‚çš„è·¯å¾„
    base_url = &quot;http://127.0.0.1:8888&quot;

    def test_get_users(self):
        &quot;&quot;&quot;æµ‹è¯•è·å–ç”¨æˆ·åˆ—è¡¨&quot;&quot;&quot;
        path = &quot;/users&quot;
        url = f&quot;{self.base_url}{path}&quot;

        res = requests.get(url, params={&quot;token&quot;:&quot;1234555&quot;})
        print(res.json())
        assert res.json()[&quot;result&quot;] == &quot;success&quot;

    def test_create_user(self):
        &quot;&quot;&quot;
        åˆ›å»ºç”¨æˆ·
        &quot;&quot;&quot;
        path = &quot;/users&quot;
        url = f&quot;{self.base_url}{path}&quot;
        data = {
            &quot;name&quot;: &quot;Jim&quot;,
            &quot;age&quot;: &quot;20&quot;,
            &quot;like&quot;: &quot;abc&quot;,
        }
        res = requests.post(url, headers={&quot;Content-Type&quot;: &quot;application/json&quot;},data=json.dumps(data))
        print(res.json())
        assert res.json()[&quot;result&quot;] == &quot;success&quot;

    def test_update_user(self):
        path = &quot;/users/1001&quot;
        url = f&quot;{self.base_url}{path}&quot;
        data = {
            &quot;name&quot;: &quot;Jim&quot;,
            &quot;age&quot;: &quot;23&quot;,
            &quot;like&quot;: &quot;jogging&quot;,
        }
        res = requests.put(url, headers={&quot;Content-Type&quot;: &quot;application/json&quot;}, data=json.dumps(data))
        print(res.json())

    def test_delete_user(self):
        path = &quot;/users/1001&quot;
        url = f&quot;{self.base_url}{path}&quot;
        res = requests.delete(url)
        print(res.json())
</code></pre>
<h3 id="63-startpy">6.3 start.py</h3>
<pre><code class="language-python"># ç¨‹åºå…¥å£æ–‡ä»¶ï¼Œå°†å¯åŠ¨æœåŠ¡çš„å‘½ä»¤æ”¾åœ¨è¿™é‡Œ
# å¢åŠ æ ¹ç›®å½•ä¸ºç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿åº•å±‚ç‰¡è›æ‰§è¡Œæ—¶ç›®å½•é”™è¯¯
import os, sys
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))   # å–åˆ°01flaskç›®å½•ï¼Œä¸ºæ ¹ç›®å½•
# print(BASE_DIR)
sys.path.insert(0, BASE_DIR)    # å¼•å…¥è‡ªå·±å†™çš„ç¨‹åºè·¯å¾„ï¼ŒåŠ ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™importå¯¼å…¥ä¼šå¼‚å¸¸

from lib.api_server import app    # åœ¨libæ–‡ä»¶å¤¹ä¸‹æ–°å»º__init__.pyæ–‡ä»¶ï¼Œåœ¨Pythonå·¥ç¨‹é‡Œï¼Œå½“pythonæ£€æµ‹åˆ°ä¸€ä¸ªç›®å½•ä¸‹å­˜åœ¨__init__.pyæ–‡ä»¶æ—¶ï¼Œpythonå°±ä¼šæŠŠå®ƒå½“æˆä¸€ä¸ªæ¨¡å—(module)ã€‚
app.run(
    port=8888,          # é»˜è®¤ç«¯å£æ˜¯5000
    host='127.0.0.1',     # host = '0.0.0.0' ä»£è¡¨å±€åŸŸç½‘å†…åˆ«äººéƒ½å¯ä»¥é€šipè®¿é—®è‡ªå·±çš„æ¥å£
    debug=True          # å¯åŠ¨æœåŠ¡,åŠ debugè‡ªåŠ¨å¸®å¿™é‡å¯
)
</code></pre>
<h3 id="64-startpyå¯åŠ¨æ—¥å¿—">6.4 start.pyå¯åŠ¨æ—¥å¿—</h3>
<pre><code class="language-commandline">/Users/yinzuopu/pythonLearn/bin/python /Users/yinzuopu/pythonLearn/01flask/bin/start.py
 * Serving Flask app 'lib.api_server' (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:8888 (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 136-091-012
127.0.0.1 - - [02/Aug/2022 15:20:54] &quot;GET / HTTP/1.1&quot; 404 -
127.0.0.1 - - [02/Aug/2022 15:20:58] &quot;GET /users HTTP/1.1&quot; 200 -
127.0.0.1 - - [02/Aug/2022 15:21:08] &quot;GET /users/10086 HTTP/1.1&quot; 400 -
127.0.0.1 - - [02/Aug/2022 15:22:34] &quot;GET /users/1001 HTTP/1.1&quot; 200 -
127.0.0.1 - - [02/Aug/2022 15:23:13] &quot;POST /users HTTP/1.1&quot; 200 -
127.0.0.1 - - [02/Aug/2022 15:23:13] &quot;DELETE /users/1001 HTTP/1.1&quot; 200 -
127.0.0.1 - - [02/Aug/2022 15:23:13] &quot;GET /users?token=1234555 HTTP/1.1&quot; 200 -
[{'id': 1001, 'name': 'Jim', 'age': '20', 'like': 'jogging'}, {'id': 1002, 'name': 'Jim', 'age': '20', 'like': 'abc'}]
127.0.0.1 - - [02/Aug/2022 15:23:13] &quot;PUT /users/1001 HTTP/1.1&quot; 400 -
</code></pre>
<h3 id="65-test_apiæ‰§è¡Œæ—¥å¿—">6.5 test_apiæ‰§è¡Œæ—¥å¿—</h3>
<pre><code class="language-commandline">/Users/yinzuopu/pythonLearn/bin/python /Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/_jb_unittest_runner.py --path /Users/yinzuopu/pythonLearn/01flask/testcase/test_api.py
Testing started at 3:23 ä¸‹åˆ ...
Launching unittests with arguments python -m unittest /Users/yinzuopu/pythonLearn/01flask/testcase/test_api.py in /Users/yinzuopu/pythonLearn/01flask/testcase

{'result': 'success', 'user': {'age': '20', 'id': 1002, 'like': 'abc', 'name': 'Jim'}}
[{'age': '20', 'id': 1001, 'like': 'jogging', 'name': 'Jim'}]
{'result': 'success', 'users': [{'age': '20', 'id': 1002, 'like': 'abc', 'name': 'Jim'}]}
{'result': 'There is no user with user_id:1001'}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[pythonç¨‹åºç›®å½•å·¥ç¨‹åŒ–]]></title>
        <id>https://yinzuopu.github.io/post/python-cheng-xu-mu-lu-gong-cheng-hua/</id>
        <link href="https://yinzuopu.github.io/post/python-cheng-xu-mu-lu-gong-cheng-hua/">
        </link>
        <updated>2022-08-02T06:37:47.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨ä¸€ä¸ªç¨‹åºå½“ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šåŒ…å«æ–‡ä»¶å¤¹ï¼šbinã€confã€libã€dataã€logsï¼Œä»¥åŠreadmeæ–‡ä»¶ã€‚<br>
<img src="https://yinzuopu.github.io/post-images/1659422595737.png" alt="" loading="lazy"><br>
æ‰€å†™ç¨‹åºå­˜æ”¾åˆ°å„è‡ªçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚ä½•è¿›è¡Œä¸²è”ï¼Ÿ<br>
é¦–å…ˆï¼Œé€šè¿‡å¯¼å…¥æ–‡ä»¶å¯¼å…¥æ¨¡å—æ–¹å¼ï¼Œå¼•ç”¨å…¶ä»–äººå†™å¥½çš„ä»£ç ã€‚<br>
å…¶æ¬¡ï¼Œæ‰¾åˆ°æœ€é¡¶å±‚çš„ç¨‹åºæ‰€åœ¨æ–‡ä»¶å¤¹ï¼ŒåŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨ä¸€ä¸ªç¨‹åºå½“ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šåŒ…å«æ–‡ä»¶å¤¹ï¼šbinã€confã€libã€dataã€logsï¼Œä»¥åŠreadmeæ–‡ä»¶ã€‚<br>
<img src="https://yinzuopu.github.io/post-images/1659422595737.png" alt="" loading="lazy"><br>
æ‰€å†™ç¨‹åºå­˜æ”¾åˆ°å„è‡ªçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚ä½•è¿›è¡Œä¸²è”ï¼Ÿ<br>
é¦–å…ˆï¼Œé€šè¿‡å¯¼å…¥æ–‡ä»¶å¯¼å…¥æ¨¡å—æ–¹å¼ï¼Œå¼•ç”¨å…¶ä»–äººå†™å¥½çš„ä»£ç ã€‚<br>
å…¶æ¬¡ï¼Œæ‰¾åˆ°æœ€é¡¶å±‚çš„ç¨‹åºæ‰€åœ¨æ–‡ä»¶å¤¹ï¼ŒåŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<!-- more -->
<pre><code class="language-python">import os, sys
BASE_PATH = os.path.dirname(os.path.dirname(os.path.abspath(file)))    #å–åˆ°å·¥ç¨‹ç›®å½•
sys.path.insert(0,BASE_PATH)        #åŠ å…¥ç¯å¢ƒå˜é‡
from lib.main import server     #å¯¼å…¥libç›®å½•ä¸‹çš„main.pyæ–‡ä»¶ã€‚
server.run(port=8000,host='127.0.0.1',debug=True)
</code></pre>
<p>è¯´æ˜ï¼š<br/><br>
1ã€os.path.abspath(file)è·å–å½“å‰æ–‡ä»¶è·¯å¾„<br>
2ã€sys.path.insert(0,BASE_PATH) åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œåœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ä¸ä¼šçœ‹åˆ°<br>
3ã€å°†host=0.0.0.0 å¯ä»¥åŒä¸ªå±€åŸŸç½‘é‡Œé¢æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[pythonå·¥ç¨‹ç›®å½•ç»“æ„ç¤ºä¾‹ï¼šç»“æ„åŒ–ä½ çš„å·¥ç¨‹]]></title>
        <id>https://yinzuopu.github.io/post/python-gong-cheng-mu-lu-jie-gou-jie-gou-hua-ni-de-gong-cheng/</id>
        <link href="https://yinzuopu.github.io/post/python-gong-cheng-mu-lu-jie-gou-jie-gou-hua-ni-de-gong-cheng/">
        </link>
        <updated>2022-08-02T06:12:21.000Z</updated>
        <summary type="html"><![CDATA[<p>æˆ‘ä»¬å¯¹äºâ€œç»“æ„åŒ–â€çš„å®šä¹‰æ˜¯æ‚¨å…³æ³¨äºæ€æ ·ä½¿æ‚¨çš„é¡¹ç›®æœ€å¥½åœ°æ»¡è¶³å®ƒçš„å¯¹è±¡æ€§ï¼Œæˆ‘ä»¬ éœ€è¦å»è€ƒè™‘å¦‚ä½•æ›´å¥½åœ°åˆ©ç”¨Pythonçš„ç‰¹æ€§æ¥åˆ›é€ ç®€æ´ã€é«˜æ•ˆçš„ä»£ç ã€‚åœ¨å®è·µå±‚é¢ï¼Œ â€œç»“æ„åŒ–â€æ„å‘³ç€é€šè¿‡ç¼–å†™ç®€æ´çš„ä»£ç ï¼Œå¹¶ä¸”æ­£å¦‚æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶å’Œç›®å½•çš„ç»„ç»‡ä¸€æ ·ï¼Œ ä»£ç åº”è¯¥ä½¿é€»è¾‘å’Œä¾èµ–æ¸…æ™°ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å¯¹äºâ€œç»“æ„åŒ–â€çš„å®šä¹‰æ˜¯æ‚¨å…³æ³¨äºæ€æ ·ä½¿æ‚¨çš„é¡¹ç›®æœ€å¥½åœ°æ»¡è¶³å®ƒçš„å¯¹è±¡æ€§ï¼Œæˆ‘ä»¬ éœ€è¦å»è€ƒè™‘å¦‚ä½•æ›´å¥½åœ°åˆ©ç”¨Pythonçš„ç‰¹æ€§æ¥åˆ›é€ ç®€æ´ã€é«˜æ•ˆçš„ä»£ç ã€‚åœ¨å®è·µå±‚é¢ï¼Œ â€œç»“æ„åŒ–â€æ„å‘³ç€é€šè¿‡ç¼–å†™ç®€æ´çš„ä»£ç ï¼Œå¹¶ä¸”æ­£å¦‚æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶å’Œç›®å½•çš„ç»„ç»‡ä¸€æ ·ï¼Œ ä»£ç åº”è¯¥ä½¿é€»è¾‘å’Œä¾èµ–æ¸…æ™°ã€‚</p>
<!-- more -->
<h2 id="é¡¹ç›®ä¸€">é¡¹ç›®ä¸€</h2>
<figure data-type="image" tabindex="1"><img src="https://yinzuopu.github.io/post-images/1659420881697.png" alt="" loading="lazy"></figure>
<h3 id="readmemd">readme.md</h3>
<p>å®ƒéœ€è¦è¯´æ˜ä»¥ä¸‹å‡ ä¸ªäº‹é¡¹:</p>
<ul>
<li>è½¯ä»¶å®šä½ï¼Œè½¯ä»¶çš„åŸºæœ¬åŠŸèƒ½ã€‚</li>
<li>è¿è¡Œä»£ç çš„æ–¹æ³•: å®‰è£…ç¯å¢ƒã€å¯åŠ¨å‘½ä»¤ç­‰ã€‚</li>
<li>ç®€è¦çš„ä½¿ç”¨è¯´æ˜ã€‚</li>
<li>ä»£ç ç›®å½•ç»“æ„è¯´æ˜ï¼Œæ›´è¯¦ç»†ç‚¹å¯ä»¥è¯´æ˜è½¯ä»¶çš„åŸºæœ¬åŸç†ã€‚</li>
<li>å¸¸è§é—®é¢˜è¯´æ˜ã€‚</li>
</ul>
<h3 id="setuppy">setup.py</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œç”¨setup.pyæ¥ç®¡ç†ä»£ç çš„æ‰“åŒ…ã€å®‰è£…ã€éƒ¨ç½²é—®é¢˜ã€‚ä¸šç•Œæ ‡å‡†çš„å†™æ³•æ˜¯ç”¨Pythonæµè¡Œçš„æ‰“åŒ…å·¥å…·setuptoolsæ¥ç®¡ç†è¿™äº›äº‹æƒ…ã€‚<br>
è¿™ç§æ–¹å¼æ™®éåº”ç”¨äºå¼€æºé¡¹ç›®ä¸­ã€‚ä¸è¿‡è¿™é‡Œçš„æ ¸å¿ƒæ€æƒ³ä¸æ˜¯ç”¨æ ‡å‡†åŒ–çš„å·¥å…·æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œè€Œæ˜¯è¯´ï¼Œä¸€ä¸ªé¡¹ç›®ä¸€å®šè¦æœ‰ä¸€ä¸ªå®‰è£…éƒ¨ç½²å·¥å…·ï¼Œèƒ½å¿«é€Ÿä¾¿æ·çš„åœ¨ä¸€å°æ–°æœºå™¨ä¸Šå°†ç¯å¢ƒè£…å¥½ã€ä»£ç éƒ¨ç½²å¥½å’Œå°†ç¨‹åºè¿è¡Œèµ·æ¥ã€‚<br>
setup.pyå¯ä»¥å°†è¿™äº›äº‹æƒ…è‡ªåŠ¨åŒ–èµ·æ¥ï¼Œæé«˜æ•ˆç‡ã€å‡å°‘å‡ºé”™çš„æ¦‚ç‡ã€‚&quot;å¤æ‚çš„ä¸œè¥¿è‡ªåŠ¨åŒ–ï¼Œèƒ½è‡ªåŠ¨åŒ–çš„ä¸œè¥¿ä¸€å®šè¦è‡ªåŠ¨åŒ–ã€‚&quot;æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¹ æƒ¯ã€‚<br>
setuptoolsçš„æ–‡æ¡£æ¯”è¾ƒåºå¤§ï¼Œåˆšæ¥è§¦çš„è¯ï¼Œå¯èƒ½ä¸å¤ªå¥½æ‰¾åˆ°åˆ‡å…¥ç‚¹ã€‚å­¦ä¹ æŠ€æœ¯çš„æ–¹å¼å°±æ˜¯çœ‹ä»–äººæ˜¯æ€ä¹ˆç”¨çš„ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹Pythonçš„ä¸€ä¸ªWebæ¡†æ¶ï¼Œflaskæ˜¯å¦‚ä½•å†™çš„: setup.pyå½“ç„¶ï¼Œç®€å•ç‚¹è‡ªå·±å†™ä¸ªå®‰è£…è„šæœ¬ï¼ˆdeploy.shï¼‰æ›¿ä»£setup.pyä¹Ÿæœªå°ä¸å¯ã€‚</p>
<h3 id="requirementstxt">requirements.txt</h3>
<p>è¿™ä¸ªæ–‡ä»¶å­˜åœ¨çš„ç›®çš„æ˜¯:<br>
æ–¹ä¾¿å¼€å‘è€…ç»´æŠ¤è½¯ä»¶çš„åŒ…ä¾èµ–ã€‚å°†å¼€å‘è¿‡ç¨‹ä¸­æ–°å¢çš„åŒ…æ·»åŠ è¿›è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œé¿å…åœ¨ setup.py å®‰è£…ä¾èµ–æ—¶æ¼æ‰è½¯ä»¶åŒ…ã€‚æ–¹ä¾¿è¯»è€…æ˜ç¡®é¡¹ç›®ä½¿ç”¨äº†å“ªäº›PythonåŒ…ã€‚<br>
è¿™ä¸ªæ–‡ä»¶çš„æ ¼å¼æ˜¯æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªåŒ…ä¾èµ–çš„è¯´æ˜ï¼Œé€šå¸¸æ˜¯flask&gt;=0.10è¿™ç§æ ¼å¼ï¼Œè¦æ±‚æ˜¯è¿™ä¸ªæ ¼å¼èƒ½è¢«pipè¯†åˆ«ï¼Œè¿™æ ·å°±å¯ä»¥ç®€å•çš„é€šè¿‡ pip install -r requirements.txtæ¥æŠŠæ‰€æœ‰PythonåŒ…ä¾èµ–éƒ½è£…å¥½äº†ã€‚</br></p>
<h3 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h3>
<details>
<pre>
<code>
#=============>binç›®å½•ï¼šå­˜æ”¾æ‰§è¡Œè„šæœ¬
#start.py
import sys,os
<p>BASE_DIR=os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>)))<br>
sys.path.append(BASE_DIR)</p>
<p>from core import core<br>
from conf import my_log_settings</p>
<p>if <strong>name</strong> == '<strong>main</strong>':<br>
my_log_settings.load_my_logging_cfg()<br>
core.run()</p>
<p>#=============&gt;confç›®å½•ï¼šå­˜æ”¾é…ç½®æ–‡ä»¶<br>
#config.ini<br>
[DEFAULT]<br>
user_timeout = 1000</p>
<p>[x]<br>
password = 123<br>
money = 10000000</p>
<p>[y]<br>
password = 123456<br>
money=1000</p>
<p>[z]<br>
password = qwe123<br>
money=10</p>
<p>#settings.py<br>
import os<br>
config_path=r'%s%s' %(os.path.dirname(os.path.abspath(<strong>file</strong>)),'config.ini')<br>
user_timeout=10<br>
user_db_path=r'%s%s' %(os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>))),<br>
'db')</p>
<p>#my_log_settings.py<br>
&quot;&quot;&quot;<br>
loggingé…ç½®<br>
&quot;&quot;&quot;</p>
<p>import os<br>
import logging.config</p>
<h1 id="å®šä¹‰ä¸‰ç§æ—¥å¿—è¾“å‡ºæ ¼å¼-å¼€å§‹">å®šä¹‰ä¸‰ç§æ—¥å¿—è¾“å‡ºæ ¼å¼ å¼€å§‹</h1>
<p>standard_format = '[%(asctime)s][%(threadName)s:%(thread)d][task_id:%(name)s][%(filename)s:%(lineno)d]' <br>
'[%(levelname)s][%(message)s]' #å…¶ä¸­nameä¸ºgetloggeræŒ‡å®šçš„åå­—</p>
<p>simple_format = '[%(levelname)s][%(asctime)s][%(filename)s:%(lineno)d]%(message)s'</p>
<p>id_simple_format = '[%(levelname)s][%(asctime)s] %(message)s'</p>
<h1 id="å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼-ç»“æŸ">å®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ ç»“æŸ</h1>
<p>logfile_dir = r'%s\log' %os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>)))  # logæ–‡ä»¶çš„ç›®å½•</p>
<p>logfile_name = 'all2.log'  # logæ–‡ä»¶å</p>
<h1 id="å¦‚æœä¸å­˜åœ¨å®šä¹‰çš„æ—¥å¿—ç›®å½•å°±åˆ›å»ºä¸€ä¸ª">å¦‚æœä¸å­˜åœ¨å®šä¹‰çš„æ—¥å¿—ç›®å½•å°±åˆ›å»ºä¸€ä¸ª</h1>
<p>if not os.path.isdir(logfile_dir):<br>
os.mkdir(logfile_dir)</p>
<h1 id="logæ–‡ä»¶çš„å…¨è·¯å¾„">logæ–‡ä»¶çš„å…¨è·¯å¾„</h1>
<p>logfile_path = os.path.join(logfile_dir, logfile_name)</p>
<h1 id="logé…ç½®å­—å…¸">logé…ç½®å­—å…¸</h1>
<p>LOGGING_DIC = {<br>
'version': 1,<br>
'disable_existing_loggers': False,<br>
'formatters': {<br>
'standard': {<br>
'format': standard_format<br>
},<br>
'simple': {<br>
'format': simple_format<br>
},<br>
},<br>
'filters': {},<br>
'handlers': {<br>
#æ‰“å°åˆ°ç»ˆç«¯çš„æ—¥å¿—<br>
'console': {<br>
'level': 'DEBUG',<br>
'class': 'logging.StreamHandler',  # æ‰“å°åˆ°å±å¹•<br>
'formatter': 'simple'<br>
},<br>
#æ‰“å°åˆ°æ–‡ä»¶çš„æ—¥å¿—,æ”¶é›†infoåŠä»¥ä¸Šçš„æ—¥å¿—<br>
'default': {<br>
'level': 'DEBUG',<br>
'class': 'logging.handlers.RotatingFileHandler',  # ä¿å­˜åˆ°æ–‡ä»¶<br>
'formatter': 'standard',<br>
'filename': logfile_path,  # æ—¥å¿—æ–‡ä»¶<br>
'maxBytes': 1024<em>1024</em>5,  # æ—¥å¿—å¤§å° 5M<br>
'backupCount': 5,<br>
'encoding': 'utf-8',  # æ—¥å¿—æ–‡ä»¶çš„ç¼–ç ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒä¸­æ–‡logä¹±ç äº†<br>
},<br>
},<br>
'loggers': {<br>
#logging.getLogger(<strong>name</strong>)æ‹¿åˆ°çš„loggeré…ç½®<br>
'': {<br>
'handlers': ['default', 'console'],  # è¿™é‡ŒæŠŠä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªhandleréƒ½åŠ ä¸Šï¼Œå³logæ•°æ®æ—¢å†™å…¥æ–‡ä»¶åˆæ‰“å°åˆ°å±å¹•<br>
'level': 'DEBUG',<br>
'propagate': True,  # å‘ä¸Šï¼ˆæ›´é«˜levelçš„loggerï¼‰ä¼ é€’<br>
},<br>
},<br>
}</p>
<p>def load_my_logging_cfg():<br>
logging.config.dictConfig(LOGGING_DIC)  # å¯¼å…¥ä¸Šé¢å®šä¹‰çš„loggingé…ç½®<br>
logger = logging.getLogger(<strong>name</strong>)  # ç”Ÿæˆä¸€ä¸ªlogå®ä¾‹<br>
logger.info('It works!')  # è®°å½•è¯¥æ–‡ä»¶çš„è¿è¡ŒçŠ¶æ€</p>
<p>if <strong>name</strong> == '<strong>main</strong>':<br>
load_my_logging_cfg()</p>
<p>#=============&gt;coreç›®å½•ï¼šå­˜æ”¾æ ¸å¿ƒé€»è¾‘<br>
#core.py<br>
import logging<br>
import time<br>
from conf import settings<br>
from lib import read_ini<br>
from conf import my_log_settings</p>
<h1 id="printname">print(<strong>name</strong>)</h1>
<p>config = read_ini.read(settings.config_path)<br>
logger = my_log_settings.load_my_logging_cfg(<strong>name</strong>)</p>
<p>current_user={'user':None,'login_time':None,'timeout':int(settings.user_timeout)}<br>
def auth(func):<br>
def wrapper(*args,**kwargs):<br>
if current_user['user']:<br>
interval=time.time()-current_user['login_time']<br>
if interval &lt; current_user['timeout']:<br>
return func(*args,**kwargs)<br>
name = input('name&gt;&gt;: ')<br>
password = input('password&gt;&gt;: ')<br>
if config.has_section(name):<br>
if password == config.get(name,'password'):<br>
logger.info('ç™»å½•æˆåŠŸ')<br>
current_user['user']=name<br>
current_user['login_time']=time.time()<br>
return func(*args,**kwargs)<br>
else:<br>
logger.error('ç™»å½•å¤±è´¥')<br>
else:<br>
logger.error('ç”¨æˆ·åä¸å­˜åœ¨')</p>
<pre><code>return wrapper
</code></pre>
<p>@auth<br>
def buy():<br>
print('buy...')</p>
<p>@auth<br>
def run():</p>
<pre><code>print('''
</code></pre>
<p>è´­ç‰©<br>
æŸ¥çœ‹ä½™é¢<br>
è½¬è´¦<br>
''')<br>
while True:<br>
choice = input('&gt;&gt;: ').strip()<br>
if not choice:continue<br>
if choice == '1':<br>
buy()</p>
<p>#=============&gt;dbç›®å½•ï¼šå­˜æ”¾æ•°æ®åº“æ–‡ä»¶<br>
#x_json<br>
#y_json</p>
<p>#=============&gt;libç›®å½•ï¼šå­˜æ”¾è‡ªå®šä¹‰çš„æ¨¡å—ä¸åŒ…<br>
#read_ini.py<br>
import configparser<br>
def read(config_file):<br>
config=configparser.ConfigParser()<br>
config.read(config_file)<br>
return config</p>
<p>#=============&gt;logç›®å½•ï¼šå­˜æ”¾æ—¥å¿—<br>
#all.log<br>
[2018-04-20 00:19:48,587][MainThread:10840][task_id:<strong>main</strong>][my_logsettiing.py:75][INFO][It works!]<br>
[2018-04-20 00:28:29,387][MainThread:9492][task_id:conf.my_log_settings][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:32:14,803][MainThread:15240][task_id:conf.my_log_settings][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:39:30,564][MainThread:11216][task_id:<strong>main</strong>][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:39:46,132][MainThread:11216][task_id:<strong>main</strong>][core.py:22][INFO][ç™»å½•æˆåŠŸ]<br>
[2018-04-20 00:41:27,929][MainThread:6644][task_id:core.core][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:41:44,162][MainThread:8620][task_id:core.core][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:41:44,163][MainThread:8620][task_id:<strong>main</strong>][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:41:53,689][MainThread:8620][task_id:core.core][core.py:29][ERROR][ç”¨æˆ·åä¸å­˜åœ¨]<br>
[2018-04-20 00:44:33,641][MainThread:14012][task_id:<strong>main</strong>][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:44:42,086][MainThread:14012][task_id:<strong>main</strong>][core.py:22][INFO][ç™»å½•æˆåŠŸ]<br>
[2018-04-20 00:47:22,321][MainThread:9460][task_id:<strong>main</strong>][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:47:25,847][MainThread:9460][task_id:<strong>main</strong>][core.py:29][ERROR][ç”¨æˆ·åä¸å­˜åœ¨]<br>
[2018-04-20 00:51:58,265][MainThread:14784][task_id:core.core][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:51:58,265][MainThread:14784][task_id:<strong>main</strong>][my_log_settings.py:75][INFO][It works!]<br>
[2018-04-20 00:52:14,703][MainThread:14784][task_id:core.core][core.py:22][INFO][ç™»å½•æˆåŠŸ]<br>
</code><br>
</pre></p>
</details>
<h2 id="é¡¹ç›®äºŒ">é¡¹ç›®äºŒ</h2>
<figure data-type="image" tabindex="2"><img src="https://yinzuopu.github.io/post-images/1659421523483.png" alt="" loading="lazy"></figure>
<ul>
<li>binç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼Œå…¶ä¸­start.pyæ–‡ä»¶æ˜¯å¯åŠ¨å…¥å£</li>
<li>confç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œconfig.yamlæ˜¯å…¶ä¸­ä¸€ä¸ªé…ç½®æ–‡ä»¶</li>
<li>coreç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒæ¨¡å—ï¼Œcore.pyæ˜¯æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è„šæœ¬æ–‡ä»¶</li>
<li>dbç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ–‡ä»¶ç›®å½•</li>
<li>libç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„é€šç”¨åŠŸèƒ½è„šæœ¬å’Œç¬¬ä¸‰æ–¹åº”ç”¨æ–‡ä»¶å­˜æ”¾ç›®å½•</li>
<li>logç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ—¥å¿—æ–‡ä»¶ç›®å½•</li>
<li>resç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å›¾æ ‡ã€å›¾ç‰‡ã€uiç­‰ç›®å½•</li>
<li>testsç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æµ‹è¯•æ–‡ä»¶ç›®å½•</li>
<li>venv-win32ç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„32ä½è™šæ‹Ÿç¯å¢ƒç›®å½•ï¼Œç”¨äºè¿è¡Œå’Œæ‰“åŒ…32åº”ç”¨ç¨‹åº</li>
<li>venv-win64ç›®å½•ï¼šæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„64ä½è™šæ‹Ÿç¯å¢ƒç›®å½•ï¼Œç”¨äºè¿è¡Œå’Œæ‰“åŒ…64åº”ç”¨ç¨‹åº</li>
<li>readme.txtï¼šé¡¹ç›®è¯´æ˜æ–‡æ¡£</li>
<li>requirements.txtï¼šç”¨äºå­˜æ”¾æ•´ä¸ªåº”ç”¨ä¾èµ–çš„å¤–éƒ¨PythonåŒ…åˆ—è¡¨</li>
</ul>
<h2 id="é¡¹ç›®ä¸‰">é¡¹ç›®ä¸‰</h2>
<p><img src="https://yinzuopu.github.io/post-images/1659421650410.png" alt="" loading="lazy"><br>
<img src="https://yinzuopu.github.io/post-images/1659421678730.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[python æœåŠ¡å™¨è¿è¡Œä»£ç æŠ¥é”™ModuleNotFoundErrorçš„è§£å†³åŠæ³•]]></title>
        <id>https://yinzuopu.github.io/post/python-fu-wu-qi-yun-xing-dai-ma-bao-cuo-modulenotfounderror-de-jie-jue-ban-fa/</id>
        <link href="https://yinzuopu.github.io/post/python-fu-wu-qi-yun-xing-dai-ma-bao-cuo-modulenotfounderror-de-jie-jue-ban-fa/">
        </link>
        <updated>2022-08-02T02:33:38.000Z</updated>
        <summary type="html"><![CDATA[<h3 id="ä¸€-é—®é¢˜æè¿°">ä¸€ã€é—®é¢˜æè¿°</h3>
<p>ä¸€æ®µ Python ä»£ç åœ¨æœ¬åœ°çš„ IDE ä¸Šè¿è¡Œæ­£å¸¸ï¼Œéƒ¨ç½²åˆ°æœåŠ¡å™¨è¿è¡Œåï¼Œå‡ºç°äº† ModuleNotFoundError: No module named â€˜xxx' é”™è¯¯ã€‚</p>
<h3 id="äºŒ-é—®é¢˜åŸå› ">äºŒã€é—®é¢˜åŸå› </h3>
<p>åœ¨ä»£ç ä¸­å¼•å…¥äº†å…¶ä»–æ–‡ä»¶çš„åŒ…ï¼ˆè‡ªå·±å†™çš„åŒ…ï¼Œé pip å®‰è£…çš„ï¼‰ï¼Œé—®é¢˜å‡ºåœ¨ import é‚£è¡Œè¯­å¥ã€‚<br>
é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºè·¯å¾„çš„åŸå› ï¼ŒæœåŠ¡å™¨ç«¯çš„è·¯å¾„å’Œæˆ‘ä»¬æœ¬åœ°çš„è·¯å¾„ä¸ä¸€æ ·æ˜¾ç¤ºã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<h3 id="ä¸€-é—®é¢˜æè¿°">ä¸€ã€é—®é¢˜æè¿°</h3>
<p>ä¸€æ®µ Python ä»£ç åœ¨æœ¬åœ°çš„ IDE ä¸Šè¿è¡Œæ­£å¸¸ï¼Œéƒ¨ç½²åˆ°æœåŠ¡å™¨è¿è¡Œåï¼Œå‡ºç°äº† ModuleNotFoundError: No module named â€˜xxx' é”™è¯¯ã€‚</p>
<h3 id="äºŒ-é—®é¢˜åŸå› ">äºŒã€é—®é¢˜åŸå› </h3>
<p>åœ¨ä»£ç ä¸­å¼•å…¥äº†å…¶ä»–æ–‡ä»¶çš„åŒ…ï¼ˆè‡ªå·±å†™çš„åŒ…ï¼Œé pip å®‰è£…çš„ï¼‰ï¼Œé—®é¢˜å‡ºåœ¨ import é‚£è¡Œè¯­å¥ã€‚<br>
é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºè·¯å¾„çš„åŸå› ï¼ŒæœåŠ¡å™¨ç«¯çš„è·¯å¾„å’Œæˆ‘ä»¬æœ¬åœ°çš„è·¯å¾„ä¸ä¸€æ ·æ˜¾ç¤ºã€‚</p>
<!-- more -->
<h3 id="ä¸‰-è§£å†³ç¤ºä¾‹">ä¸‰ã€è§£å†³ç¤ºä¾‹</h3>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨è‡ªå·±ä»£ç çš„é¡¶ç«¯åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-python">import sys
import os
sys.path.append(os.path.dirname(sys.path[0]))
</code></pre>
<p>æˆ–è€…</p>
<pre><code class="language-python">import sys
import os
 
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.insert(0, BASE_DIR)
</code></pre>
<h3 id="å››-syspathappend-å’Œ-syspathinsertä»¥ä¸Šä»£ç å¯ä»¥ä¿è¯åœ¨ä»»ä½•æ—¶å€™éƒ½åˆ‡æ¢åˆ°å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨ç›®å½•ä¸­å…·ä½“æ ¹æ®è‡ªå·±è„šæœ¬æ‰€åœ¨çš„ç›®å½•ç»“æ„è¿›è¡Œè°ƒæ•´">å››ã€sys.path.append() å’Œ sys.path.insert()ä»¥ä¸Šä»£ç å¯ä»¥ä¿è¯åœ¨ä»»ä½•æ—¶å€™éƒ½åˆ‡æ¢åˆ°å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨ç›®å½•ä¸­ï¼Œå…·ä½“æ ¹æ®è‡ªå·±è„šæœ¬æ‰€åœ¨çš„ç›®å½•ç»“æ„è¿›è¡Œè°ƒæ•´ã€‚</h3>
<p>Python ç¨‹åºä¸­ä½¿ç”¨ import xxx æ—¶ï¼ŒPython è§£æå™¨ä¼šåœ¨å½“å‰ç›®å½•ã€å·²å®‰è£…å’Œç¬¬ä¸‰æ–¹æ¨¡å—ä¸­æœç´¢ xxxï¼Œå¦‚æœéƒ½æœç´¢ä¸åˆ°å°±ä¼šæŠ¥é”™ã€‚</p>
<ul>
<li>sys.path æ¨¡å—å¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ç³»ç»Ÿè·¯å¾„ï¼Œè¿™ç§æ–¹æ³•å¯¼å…¥çš„è·¯å¾„ä¼šåœ¨ Python ç¨‹åºé€€å‡ºåå¤±æ•ˆã€‚</li>
<li>sys.path æœ¬èº«æ˜¯ä¸ªåˆ—è¡¨ï¼Œæ‰€ä»¥åœ¨é‡Œé¢æ·»åŠ ç›®å½•æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œæ·»åŠ å®Œåï¼Œæ–°ç›®å½•å³æ—¶èµ·æ•ˆï¼Œä»¥åçš„æ¯æ¬¡ import æ“ä½œéƒ½å¯èƒ½ä¼šæ£€æŸ¥è¿™ä¸ªç›®å½•ã€‚</li>
</ul>
<h4 id="41-syspathappend">4.1  sys.path.append()</h4>
<p>åœ¨ sys.path åˆ—è¡¨çš„æœ«å°¾ä¸´æ—¶æ·»åŠ æœç´¢è·¯å¾„ï¼Œæ–¹ä¾¿æ›´ç®€æ´çš„ import å…¶ä»–åŒ…å’Œæ¨¡å—ã€‚è¿™ç§æ–¹æ³•å¯¼å…¥çš„è·¯å¾„ä¼šåœ¨ Python ç¨‹åºé€€å‡ºåå¤±æ•ˆã€‚</p>
<pre><code class="language-python">import sys
sys.path.append('..') # è¡¨ç¤ºå¯¼å…¥å½“å‰æ–‡ä»¶çš„ä¸Šå±‚ç›®å½•åˆ°æœç´¢è·¯å¾„ä¸­
sys.path.append('/home/model') # ç»å¯¹è·¯å¾„
from folderA.folderB.fileA import functionA
</code></pre>
<h4 id="42-syspathinsert">4.2 sys.path.insert()</h4>
<p>å¯ä»¥å®šä¹‰æœç´¢ä¼˜å…ˆé¡ºåºï¼Œåºå·ä» 0 å¼€å§‹ï¼Œè¡¨ç¤ºæœ€å¤§ä¼˜å…ˆçº§ï¼Œsys.path.insert() åŠ å…¥çš„ä¹Ÿæ˜¯ä¸´æ—¶æœç´¢è·¯å¾„ï¼Œç¨‹åºé€€å‡ºåå¤±æ•ˆã€‚</p>
<pre><code class="language-python">sys.path.insert(1, &quot;./model&quot;)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Yin]]></title>
        <id>https://yinzuopu.github.io/post/hello-gridea/</id>
        <link href="https://yinzuopu.github.io/post/hello-gridea/">
        </link>
        <updated>2022-07-28T07:09:40.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿å…‰ä¸´æˆ‘çš„å°ç«™ï¼<br>
âœï¸  æˆ‘å¸Œæœ›æˆ‘èƒ½åšæŒä¸‹æ¥è®°å½•ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿å…‰ä¸´æˆ‘çš„å°ç«™ï¼<br>
âœï¸  æˆ‘å¸Œæœ›æˆ‘èƒ½åšæŒä¸‹æ¥è®°å½•ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/yinzuopu">Github</a><br>
<a href="https://yinzuopu.github.io">blog ä¸»é¡µ</a></p>
]]></content>
    </entry>
</feed>